// DOM-ready не нужен -- скрипты и так в конце боди

// Funcs
(function($) {

	$.fn.cleanWS = function(options){
		this.each(function(){
			var container = this, nodes = container.childNodes;
			var i = nodes.length-1;
			while (i>-1) { if (nodes[i].nodeType == 3) container.removeChild(nodes[i]); 
				i--;
			}
		});
	}

	function organizeMap(options){
		ymaps.ready(init);

		var map, pm, z, c,
			enlarge = $('#js-map_enlarge'),
			reduce = $('#js-map_reduce'),
			down = $('#js-map_down'),
			up = $('#js-map_up'),
			left = $('#js-map_left'),
			right = $('#js-map_right');

		function init(){

			map = new ymaps.Map ('js-map_cont', {
				center: [55.76, 37.64],
				zoom: 17,
			});

			map.behaviors.enable('multiTouch');

			pm = new ymaps.Placemark([55.76, 37.64], {}, {
				iconImageHref: 'i/pm.png',
				iconImageSize: [68, 62],
				iconImageOffset: [-14, -42]
			});

			map.geoObjects.add(pm);

			checkForDisabled();

			enlarge.on('click', function() {
				z = map.getZoom();
				if (z < 17) {
					map.setZoom(z + 1);
				}
				checkForDisabled();
			});

			reduce.on('click', function() {
				z = map.getZoom();
				if (z >= 1) {
					map.setZoom(z - 1);
				}
				checkForDisabled();
			});

			down.on('click', function() {
				c = map.getCenter();
				map.setCenter([c[0] - 0.0003, c[1]])
			});

			up.on('click', function() {
				c = map.getCenter();
				map.setCenter([c[0] + 0.0003,c[1]])
			});

			left.on('click', function() {
				c = map.getCenter();
				map.setCenter([c[0],c[1] - 0.0005])
			});

			right.on('click', function() {
				c = map.getCenter();
				map.setCenter([c[0],c[1] + 0.0005])
			});

			function checkForDisabled() {
				z = map.getZoom();
				if (z === 1) {
					reduce.addClass('__disabled');
					enlarge.removeClass('__disabled');
				} else if (z > 1 && z < 17) {
					reduce.removeClass('__disabled');
					enlarge.removeClass('__disabled');
				} else if (z === 17) {
					reduce.removeClass('__disabled');
					enlarge.addClass('__disabled');
				}
			}

		}
	}

	$('.js-cleanWS').cleanWS();

	if ($('#js-map').length > 0) {
		organizeMap();
	}

})(jQuery);